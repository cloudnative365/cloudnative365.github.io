<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="keywords" content=" keynotes, advanced, kubernetes, CKA, APIS_AND_ACCESS">
<title>APIS_AND_ACCESS | CloudNative knowledge</title>
<link rel="stylesheet" href="css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="cloudnative365.gitpage.io" href="http://0.0.0.0:4000/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> 云原生技术课堂</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">课程<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="lessons_syllabus.html">教学大纲</a></li>
                        
                        
                        
                        <li><a href="lessons_plans.html">开课计划</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">课堂笔记<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="keynotes_L1_basic.html">基础课程</a></li>
                        
                        
                        
                        <li><a href="keynotes_L2_advanced.html">进阶课程</a></li>
                        
                        
                        
                        <li><a href="keynotes_L3_senior.html">高级课程</a></li>
                        
                        
                        
                        <li><a href="keynotes_L4_architect.html">架构师课程</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">课堂风采<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="classes_teachers.html">讲师风采</a></li>
                        
                        
                        
                        <li><a href="classes_aboutus.html">关于我们</a></li>
                        
                        
                        
                        <li><a href="classes_successd.html">优秀学员作品</a></li>
                        
                        
                    </ul>
                </li>
                
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">常用链接<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        
                        
                        <li><a href="https://www.cncf.io/" target="_blank" rel="noopener">CNCF Foundation</a></li>
                        
                        
                        
                        <li><a href="https://www.linuxfoundation.org/" target="_blank" rel="noopener">Linux Foundation</a></li>
                        
                        
                        
                        <li><a href="https://cd.foundation/" target="_blank" rel="noopener">CD Foundation</a></li>
                        
                        
                    </ul>
                </li>
                
                
                
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="APIS_AND_ACCESS">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">进阶课程 </li>
  
  
  
      
  
  <li>
      <a title="第一章 CKA官方教程" href="#">第一章 CKA官方教程</a>
      <ul>
          
          
          
          <li><a title="1 COURSE_INTRODUCTION" href="keynotes_L2_advanced_1_kubernetes_1_CKA_1_COURSE_INTRODUCTION.html">1 COURSE_INTRODUCTION</a></li>
          
          
          
          
          
          
          <li><a title="2 BASICS_OF_KUBERNETES" href="keynotes_L2_advanced_1_kubernetes_1_CKA_2_BASICS_OF_KUBERNETES.html">2 BASICS_OF_KUBERNETES</a></li>
          
          
          
          
          
          
          <li><a title="3 INSTALLATION_AND_CONFIGURATION" href="keynotes_L2_advanced_1_kubernetes_1_CKA_3_INSTALLATION_AND_CONFIGURATION.html">3 INSTALLATION_AND_CONFIGURATION</a></li>
          
          
          
          
          
          
          <li><a title="4 KUBERNETES_ARCHITECTURE" href="keynotes_L2_advanced_1_kubernetes_1_CKA_4_KUBERNETES_ARCHITECTURE.html">4 KUBERNETES_ARCHITECTURE</a></li>
          
          
          
          
          
          
          <li class="active"><a title="5 APIS_AND_ACCESS" href="keynotes_L2_advanced_1_kubernetes_1_CKA_5_APIS_AND_ACCESS.html">5 APIS_AND_ACCESS</a></li>
          
          
          
          
          
          
          <li><a title="6 API_OBJECTS" href="keynotes_L2_advanced_1_kubernetes_1_CKA_6_API_OBJECTS.html">6 API_OBJECTS</a></li>
          
          
          
          
          
          
          <li><a title="7 MANAGING_STATE_WITH_DEPLOYMENTS" href="keynotes_L2_advanced_1_kubernetes_1_CKA_7_MANAGING_STATE_WITH_DEPLOYMENTS.html">7 MANAGING_STATE_WITH_DEPLOYMENTS</a></li>
          
          
          
          
          
          
          <li><a title="8 SERVICES" href="keynotes_L2_advanced_1_kubernetes_1_CKA_8_SERVICES.html">8 SERVICES</a></li>
          
          
          
          
          
          
          <li><a title="9 VOLUMES_AND_DATA" href="keynotes_L2_advanced_1_kubernetes_1_CKA_9_VOLUMES_AND_DATA.html">9 VOLUMES_AND_DATA</a></li>
          
          
          
          
          
          
          <li><a title="10 INGRESS" href="keynotes_L2_advanced_1_kubernetes_1_CKA_10_INGRESS.html">10 INGRESS</a></li>
          
          
          
          
          
          
          <li><a title="11 SCHEDULING" href="keynotes_L2_advanced_1_kubernetes_1_CKA_11_SCHEDULING.html">11 SCHEDULING</a></li>
          
          
          
          
          
          
          <li><a title="12 LOGGING_AND_TROUBLESHOOTING" href="keynotes_L2_advanced_1_kubernetes_1_CKA_12_LOGGING_AND_TROUBLESHOOTING.html">12 LOGGING_AND_TROUBLESHOOTING</a></li>
          
          
          
          
          
          
          <li><a title="13 CUSTOM_RESOURCE_DEFINITIONS" href="keynotes_L2_advanced_1_kubernetes_1_CKA_13_CUSTOM_RESOURCE_DEFINITIONS.html">13 CUSTOM_RESOURCE_DEFINITIONS</a></li>
          
          
          
          
          
          
          <li><a title="14 HELM" href="keynotes_L2_advanced_1_kubernetes_1_CKA_14_HELM.html">14 HELM</a></li>
          
          
          
          
          
          
          <li><a title="15 SECURITY" href="keynotes_L2_advanced_1_kubernetes_1_CKA_15_SECURITY.html">15 SECURITY</a></li>
          
          
          
          
          
          
          <li><a title="16 HIGH_AVAILABILITY" href="keynotes_L2_advanced_1_kubernetes_1_CKA_16_HIGH_AVAILABILITY.html">16 HIGH_AVAILABILITY</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="第二章 CKAD官方教程" href="#">第二章 CKAD官方教程</a>
      <ul>
          
          
          
          <li><a title="CloudNative Roadmap" href="mydoc_release_notes_60.html">CloudNative Roadmap</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a title="第三章 kubernetes入门讲座" href="#">第三章 kubernetes入门讲座</a>
      <ul>
          
          
          
          <li><a title="1. 课程介绍" href="keynotes_L2_advanced_3_kubernetes_1_COURSE_INTRODUCTION.html">1. 课程介绍</a></li>
          
          
          
          
          
          
          <li><a title="2. 认识kubernetes" href="keynotes_L2_advanced_3_kubernetes_2_BASICS_OF_KUBERNETES.html">2. 认识kubernetes</a></li>
          
          
          
          
          
          
          <li><a title="3. kubernetes架构和基础概念" href="keynotes_L2_advanced_3_kubernetes_3_KUBERNETES_ARCHITECTURE.html">3. kubernetes架构和基础概念</a></li>
          
          
          
          
          
          
          <li><a title="4. 安装和配置kubernetes实验环境" href="keynotes_L2_advanced_3_kubernetes_4_INSTALLATION_AND_CONFIGURATION.html">4. 安装和配置kubernetes实验环境</a></li>
          
          
          
          
          
          
          <li><a title="5. 使用命令行管理资源" href="keynotes_L2_advanced_3_kubernetes_5_MANAGE_RESOURCES_WITH_CMD.html">5. 使用命令行管理资源</a></li>
          
          
          
          
          
          
          <li><a title="6. 使用清单文件管理资源" href="keynotes_L2_advanced_3_kubernetes_6_MANAGE_RESOURCES_WITH_MANIFEST.html">6. 使用清单文件管理资源</a></li>
          
          
          
          
          
          
          <li><a title="7. POD" href="keynotes_L2_advanced_3_kubernetes_7_POD.html">7. POD</a></li>
          
          
          
          
          
          
          <li><a title="8. 标签和标签选择器" href="keynotes_L2_advanced_3_kubernetes_8_LABEL_AND_SELECTOR.html">8. 标签和标签选择器</a></li>
          
          
          
          
          
          
          <li><a title="9. Deployment" href="keynotes_L2_advanced_3_kubernetes_9_CONTROLLER.html">9. Deployment</a></li>
          
          
          
          
          
          
          <li><a title="10. Service" href="keynotes_L2_advanced_3_kubernetes_10_SERVICE.html">10. Service</a></li>
          
          
          
          
          
          
          <li><a title="11. pv" href="keynotes_L2_advanced_3_kubernetes_11_PV.html">11. pv</a></li>
          
          
          
          
          
          
          <li><a title="12. configmap和secret" href="keynotes_L2_advanced_3_kubernetes_12_SECRET_AND_CONFIGMAP.html">12. configmap和secret</a></li>
          
          
          
          
          
          
          <li><a title="13. API" href="keynotes_L2_advanced_3_kubernetes_13_APIS_AND_ACCESS.html">13. API</a></li>
          
          
          
          
          
          
          <li><a title="14. STATEFULSET" href="keynotes_L2_advanced_3_kubernetes_14_STATEFULSET.html">14. STATEFULSET</a></li>
          
          
          
          
          
          
          <li><a title="15. INGRESS" href="keynotes_L2_advanced_3_kubernetes_15_INGRESS.html">15. INGRESS</a></li>
          
          
          
          
          
          
          <li><a title="16. 调度" href="keynotes_L2_advanced_3_kubernetes_16_SCHEDULING.html">16. 调度</a></li>
          
          
          
          
          
          
          <li><a title="17. 日志和错误定位" href="keynotes_L2_advanced_3_kubernetes_17_LOGGING_AND_TROUBLESHOOTING.html">17. 日志和错误定位</a></li>
          
          
          
          
          
          
          <li><a title="18. 自定义资源" href="keynotes_L2_advanced_3_kubernetes_18_CUSTOM_RESOURCE_DEFINTIONS.html">18. 自定义资源</a></li>
          
          
          
          
          
          
          <li><a title="19. HELM" href="keynotes_L2_advanced_3_kubernetes_19_HELM.html">19. HELM</a></li>
          
          
          
          
          
          
          <li><a title="20. SECURITY" href="keynotes_L2_advanced_3_kubernetes_20_SECURITY.html">20. SECURITY</a></li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <div class="post-header">
   <h1 class="post-title-main">APIS_AND_ACCESS</h1>
</div>



<div class="post-content">

   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    


    

   <h2 id="learning-objectives">Learning Objectives</h2>

<p>By the end of this chapter, you should be able to:</p>

<ul>
  <li>Understand the API REST-based architecture.</li>
  <li>Work with annotations.</li>
  <li>Understand a simple Pod template.</li>
  <li>Use kubectl with greater verbosity for troubleshooting.</li>
  <li>Separate cluster resources using namespaces.</li>
</ul>

<h2 id="apis_and_access">APIS_AND_ACCESS</h2>

<h3 id="api-access">API Access</h3>

<p>Kubernetes has a powerful REST-based API. The entire architecture is API-driven. Knowing where to find resource endpoints and understanding how the API changes between versions can be important to ongoing administrative tasks, as there is much ongoing change and growth. Starting with v1.16 deprecated objects are no longer honored by the API server.</p>

<p>As we learned in the <em>Kubernetes Architecture</em> chapter, the main agent for communication between cluster agents and from outside the cluster is the kube-apiserver. A <strong>curl</strong> query to the agent will expose the current API groups. Groups may have multiple versions, which evolve independently of other groups, and follow a domain-name format with several names reserved, such as single-word domains, the empty group, and any name ending in <strong>.k8s.io</strong>.</p>

<h3 id="restful">RESTful</h3>

<p>kubectl makes API calls on your behalf, responding to typical HTTP verbs (<strong>GET</strong>, <strong>POST</strong>, <strong>DELETE</strong>). You can also make calls externally, using <strong>curl</strong> or other program. With the appropriate certificates and keys, you can make requests, or pass JSON files to make configuration changes.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">--cert</span> userbob.pem <span class="nt">--key</span> userBob-key.pem <span class="se">\ </span> 
<span class="nt">--cacert</span> /path/to/ca.pem <span class="se">\ </span>  
https://k8sServer:6443/api/v1/pods 
</code></pre></div></div>

<p>The ability to impersonate other users or groups, subject to RBAC configuration, allows a manual override authentication. This can be helpful for debugging authorization policies of other users.</p>

<h3 id="checking-access">Checking Access</h3>

<p>While there is more detail on security in a later chapter, it is helpful to check the current authorizations, both as an administrator, as well as another user. The following shows what user <strong>bob</strong> could do in the <strong>default</strong> namespace and the <strong>developer</strong> namespace, using the <strong>auth can-i</strong> subcommand to query:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl auth can-i create deployments
yes 

<span class="nv">$ </span>kubectl auth can-i create deployments <span class="nt">--as</span> bob
no 

<span class="nv">$ </span>kubectl auth can-i create deployments <span class="nt">--as</span> bob <span class="nt">--namespace</span> developer
yes 
</code></pre></div></div>

<p>There are currently three APIs which can be applied to set who and what can be queried:</p>

<ul>
  <li>
    <p><strong>SelfSubjectAccessReview</strong>
Access review for any user, helpful for delegating to others.</p>
  </li>
  <li>
    <p><strong>LocalSubjectAccessReview</strong>
​Review is restricted to a specific namespace.</p>
  </li>
  <li>
    <p><strong>SelfSubjectRulesReview</strong>
A review which shows allowed actions for a user within a particular namespace.</p>
  </li>
</ul>

<p>The use of <strong>reconcile</strong> allows a check of authorization necessary to create an object from a file. No output indicates the creation would be allowed.</p>

<h3 id="optimistic-concurrency">Optimistic Concurrency</h3>

<p>The default serialization for API calls must be JSON. There is an effort to use Google’s <em>protobuf</em> serialization, but this remains experimental. While we may work with files in a YAML format, they are converted to and from JSON.</p>

<p>Kubernetes uses the <strong>resourceVersion</strong> value to determine API updates and implement optimistic concurrency. In other words, an object is not locked from the time it has been read until the object is written.</p>

<p>Instead, upon an updated call to an object, the <strong>resourceVersion</strong> is checked, and a <strong>409 CONFLICT</strong> is returned, should the number have changed. The <strong>resourceVersion</strong> is currently backed via the <strong>modifiedIndex</strong> parameter in the etcd database, and is unique to the namespace, kind, and server. Operations which do not change an object, such as <strong>WATCH</strong> or <strong>GET</strong>, do not update this value.</p>

<h3 id="using-annotations">Using Annotations</h3>

<p>Labels are used to work with objects or collections of objects; annotations are not.</p>

<p>Instead, annotations allow for metadata to be included with an object that may be helpful outside of the Kubernetes object interaction. Similar to labels, they are key to value maps. They are also able to hold more information, and more human-readable information than labels.</p>

<p>Having this kind of metadata can be used to track information such as a timestamp, pointers to related objects from other ecosystems, or even an email from the developer responsible for that object’s creation.</p>

<p>The annotation data could otherwise be held in an exterior database, but that would limit the flexibility of the data. The more this metadata is included, the easier it is to integrate management and deployment tools or shared client libraries.</p>

<p>For example, to annotate only Pods within a namespace, you can overwrite the annotation, and finally delete it:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl annotate pods <span class="nt">--all</span> <span class="nv">description</span><span class="o">=</span><span class="s1">'Production Pods'</span> <span class="nt">-n</span> prod 

<span class="nv">$ </span>kubectl annotate <span class="nt">--overwrite</span> pods <span class="nv">description</span><span class="o">=</span><span class="s2">"Old Production Pods"</span> <span class="nt">-n</span> prod 

<span class="nv">$ </span>kubectl annotate pods foo description- <span class="nt">-n</span> prod
</code></pre></div></div>

<h3 id="simple-pod">Simple Pod</h3>

<p>As discussed earlier, a Pod is the lowest compute unit and individual object we can work with in Kubernetes. It can be a single container, but often, it will consist of a primary application container and one or more supporting containers.</p>

<p>Below is an example of a simple pod manifest in YAML format. You can see the <strong>apiVersion</strong> (it must match the existing API group), the <strong>kind</strong> (the type of object to create), the <strong>metadata</strong> (at least a name), and its <strong>spec</strong> (what to create and parameters), which define the container that actually runs in this pod:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: v1
kind: Pod
metadata:
    name: firstpod
spec:
    containers:
    - image: nginx
      name: stan 
</code></pre></div></div>

<p>You can use the <strong>kubectl create</strong> command to create this pod in Kubernetes. Once it is created, you can check its status with <strong>kubectl get pods</strong>. The output is omitted to save space:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl create <span class="nt">-f</span> simple.yaml 

<span class="nv">$ </span>kubectl get pods 

<span class="nv">$ </span>kubectl get pod firstpod <span class="nt">-o</span> yaml 

<span class="nv">$ </span>kubectl get pod firstpod <span class="nt">-o</span> json
</code></pre></div></div>

<h3 id="manage-api-resources-with-kubectl">Manage API Resources with kubectl</h3>

<p>Kubernetes exposes resources via RESTful API calls, which allows all resources to be managed via HTTP, JSON or even XML, the typical protocol being HTTP. The state of the resources can be changed using standard HTTP verbs (e.g. <strong>GET</strong>, <strong>POST</strong>, <strong>PATCH</strong>, <strong>DELETE</strong>, etc.).</p>

<p><strong>kubectl</strong> has a verbose mode argument which shows details from where the command gets and updates information. Other output includes <strong>curl</strong> commands you could use to obtain the same result. While the verbosity accepts levels from zero to any number, there is currently no verbosity value greater than ten. You can check this out for <strong>kubectl get</strong>. The output below has been formatted for clarity:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl <span class="nt">--v</span><span class="o">=</span>10 get pods firstpod

....
I1215 17:46:47.860958 29909 round_trippers.go:417]
curl <span class="nt">-k</span> <span class="nt">-v</span> <span class="nt">-XGET</span> <span class="nt">-H</span> <span class="s2">"Accept: application/json"</span>
<span class="nt">-H</span> <span class="s2">"User-Agent: kubectl/v1.8.5 (linux/amd64) kubernetes/cce11c6"</span>
https://10.128.0.3:6443/api/v1/namespaces/default/pods/firstpod
....
</code></pre></div></div>

<p>If you delete this pod, you will see that the HTTP method changes from <strong>XGET</strong> to <strong>XDELETE</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl <span class="nt">--v</span><span class="o">=</span>10 delete pods firstpod

....
I1215 17:49:32.166115 30452 round_trippers.go:417]
curl <span class="nt">-k</span> <span class="nt">-v</span> <span class="nt">-XDELETE</span> <span class="nt">-H</span> <span class="s2">"Accept: application/json, */*"</span>
<span class="nt">-H</span> <span class="s2">"User-Agent: kubectl/v1.8.5 (linux/amd64) kubernetes/cce11c6"</span>
https://10.128.0.3:6443/api/v1/namespaces/default/pods/firstpod
....
</code></pre></div></div>

<h3 id="access-from-outside-the-cluster">Access from Outside the Cluster</h3>

<p>The primary tool used from the command line will be <strong>kubectl</strong>, which calls <strong>curl</strong> on your behalf. You can also use the <strong>curl</strong> command from outside the cluster to view or make changes.</p>

<p>The basic server information, with redacted TLS certificate information, can be found in the output of</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl config view 
</code></pre></div></div>

<p>If you view the verbose output from a previous page, you will note that the first line references a configuration file where this information is pulled from, <strong>~/.kube/config</strong>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>I1215 17:35:46.725407 27695 loader.go:357] 
     Config loaded from file /home/student/.kube/config 
</code></pre></div></div>

<p>Without the certificate authority, key and certificate from this file, only insecure <strong>curl</strong> commands can be used, which will not expose much due to security settings. We will use <strong>curl</strong> to access our cluster using TLS in an upcoming lab.</p>

<h3 id="kubeconfig">~/.kube/config</h3>

<p>Take a look at the output below:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdF.....
    server: https://10.128.0.3:6443 
    name: kubernetes
contexts:
- context:
    cluster: kubernetes
    user: kubernetes-admin
  name: kubernetes-admin@kubernetes
current-context: kubernetes-admin@kubernetes
kind: Config
preferences: <span class="o">{}</span>
users:
- name: kubernetes-admin
  user:
    client-certificate-data: LS0tLS1CRUdJTib.....
    client-key-data: LS0tLS1CRUdJTi....
</code></pre></div></div>

<p>The output above shows 19 lines of output, with each of the keys being heavily truncated. While the keys may look similar, close examination shows them to be distinct.</p>

<ul>
  <li>apiVersion</li>
</ul>

<p>As with other objects, this instructs the kube-apiserver where to assign the data.</p>

<ul>
  <li>clusters</li>
</ul>

<p>This key contains the name of the cluster, as well as where to send the API calls. The <strong>certificate-authority-data</strong> is passed to authenticate the curl request.</p>

<ul>
  <li>contexts</li>
</ul>

<p>This is a setting which allows easy access to multiple clusters, possibly as various users, from one configuration file. It can be used to set <strong>namespace</strong>, <strong>user</strong>, and <strong>cluster</strong>.</p>

<ul>
  <li>current-context</li>
</ul>

<p>This shows which cluster and user the <strong>kubectl</strong> command would use. These settings can also be passed on a per-command basis.</p>

<ul>
  <li>kind</li>
</ul>

<p>Every object within Kubernetes must have this setting; in this case, a declaration of object type <strong>Config</strong>.</p>

<ul>
  <li>preferences</li>
</ul>

<p>Currently not used, this is an optional settings for the <strong>kubectl</strong> command, such as colorizing output.</p>

<ul>
  <li>users</li>
</ul>

<p>A nickname associated with client credentials, which can be client key and certificate, username and password, and a token. Token and username/password are mutually exclusive. These can be configured via the <strong>kubectl config set-credentials</strong> command.</p>

<h3 id="working-with-namespaces">Working with Namespaces</h3>

<p>Take a look at the following commands:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl get ns

<span class="nv">$ </span>kubectl create ns linuxcon

<span class="nv">$ </span>kubectl describe ns linuxcon

<span class="nv">$ </span>kubectl get ns/linuxcon <span class="nt">-o</span> yaml

<span class="nv">$ </span>kubectl delete ns/linuxcon
</code></pre></div></div>

<p>The above commands show how to view, create and delete namespaces. Note that the <strong>describe</strong> subcommand shows several settings, such as Labels, Annotations, resource quotas, and resource limits, which we will discus later in the course.</p>

<p>Once a namespace has been created, you can reference it via YAML when creating a resource:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>redis.yaml

apiVersion: V1
kind: Pod
metadata:
    name: redis
    namespace: linuxcon
...
</code></pre></div></div>

<h3 id="api-resources-with-kubectl">API Resources with kubectl</h3>

<p>All API resources exposed are available via <strong>kubectl</strong>. To get more information, do <strong>kubectl help</strong>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>kubectl <span class="o">[</span><span class="nb">command</span><span class="o">]</span> <span class="o">[</span><span class="nb">type</span><span class="o">]</span> <span class="o">[</span>Name] <span class="o">[</span>flag]
</code></pre></div></div>

<p>Expect the list below to change:</p>

<table>
  <thead>
    <tr>
      <th><strong>all</strong></th>
      <th><strong>events</strong> (<strong>ev</strong>)</th>
      <th><strong>podsecuritypolicies</strong> (<strong>psp</strong>)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>certificatesigningrequests</strong> (<strong>csr</strong>)</td>
      <td><strong>horizontalpodautoscalers</strong> (<strong>hpa</strong>)</td>
      <td><strong>podtemplates</strong></td>
    </tr>
    <tr>
      <td><strong>clusterrolebindings</strong></td>
      <td><strong>ingresses</strong> (<strong>ing</strong>)</td>
      <td><strong>replicasets</strong> (<strong>rs</strong>)</td>
    </tr>
    <tr>
      <td><strong>clusterroles</strong></td>
      <td><strong>jobs</strong></td>
      <td><strong>replicationcontrollers</strong> (<strong>rc</strong>)</td>
    </tr>
    <tr>
      <td><strong>clusters</strong> (valid only for federation apiservers)</td>
      <td><strong>limitranges</strong> (<strong>limits</strong>)</td>
      <td><strong>resourcequotas</strong> (<strong>quota</strong>)</td>
    </tr>
    <tr>
      <td><strong>componentstatuses</strong> (<strong>cs</strong>)</td>
      <td><strong>namespaces</strong> (<strong>ns</strong>)</td>
      <td><strong>rolebindings</strong></td>
    </tr>
    <tr>
      <td><strong>configmaps</strong> (<strong>cm</strong>)</td>
      <td><strong>networkpolicies</strong> (<strong>netpol</strong>)</td>
      <td><strong>roles</strong></td>
    </tr>
    <tr>
      <td><strong>controllerrevisions</strong></td>
      <td><strong>nodes</strong> (<strong>no</strong>)</td>
      <td><strong>secrets</strong></td>
    </tr>
    <tr>
      <td><strong>cronjobs</strong></td>
      <td><strong>persistentvolumeclaims</strong> (<strong>pvc</strong>)</td>
      <td><strong>serviceaccounts</strong> (<strong>sa</strong>)</td>
    </tr>
    <tr>
      <td><strong>customresourcedefinition</strong> (<strong>crd</strong>)</td>
      <td><strong>persistentvolumes</strong> (<strong>pv</strong>)</td>
      <td><strong>services</strong> (<strong>svc</strong>)</td>
    </tr>
    <tr>
      <td><strong>daemonsets</strong> (<strong>ds</strong>)</td>
      <td><strong>poddisruptionbudgets</strong> (<strong>pdb</strong>)</td>
      <td><strong>statefulsets</strong></td>
    </tr>
    <tr>
      <td><strong>deployments</strong> (<strong>deploy</strong>)</td>
      <td><strong>podpreset</strong></td>
      <td><strong>storageclasses</strong></td>
    </tr>
    <tr>
      <td><strong>endpoints</strong> (<strong>ep</strong>)</td>
      <td><strong>pods</strong> (<strong>po</strong>)</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<h3 id="additional-resource-methods">Additional Resource Methods</h3>

<p>In addition to basic resource management via REST, the API also provides some extremely useful endpoints for certain resources.</p>

<p>For example, you can access the logs of a container, exec into it, and watch changes to it with the following endpoints:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl <span class="nt">--cert</span> /tmp/client.pem <span class="nt">--key</span> /tmp/client-key.pem <span class="se">\</span>
<span class="nt">--cacert</span> /tmp/ca.pem <span class="nt">-v</span> <span class="nt">-XGET</span> <span class="se">\ </span>
https://10.128.0.3:6443/api/v1/namespaces/default/pods/firstpod/log
</code></pre></div></div>

<p>This would be the same as the following. If the container does not have any standard out, there would be no logs.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl logs firstpod
</code></pre></div></div>

<p>There are other calls you could make, following the various API groups on your cluster:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /api/v1/namespaces/{namespace}/pods/{name}/exec

GET /api/v1/namespaces/{namespace}/pods/{name}/log

GET /api/v1/watch/namespaces/{namespace}/pods/{name}
</code></pre></div></div>

<h3 id="swagger-and-openapi">Swagger and OpenAPI</h3>

<p>The entire Kubernetes API uses a Swagger specification. This is evolving towards the OpenAPI initiative. It is extremely useful, as it allows, for example, to auto-generate client code. All the stable resources definitions are available on the documentation site.</p>

<p>You can browse some of the API groups via a Swagger UI on the <a href="https://swagger.io/specification/">OpenAPI Specification web page</a>.</p>

<p><img src="/pages/keynotes/L2_advanced/1_CKA/pics/5_APIS_AND_ACCESS/d0czu3b6py8d-swagger.png" alt="Swagger" /></p>

<h3 id="api-maturity">API Maturity</h3>

<p>The use of API groups and different versions allows for development to advance without changes to an existing group of APIs. This allows for easier growth and separation of work among separate teams. While there is an attempt to maintain some consistency between API and software versions, they are only indirectly linked.</p>

<p>The use of JSON and Google’s Protobuf serialization scheme will follow the same release guidelines.</p>

<ul>
  <li>Alpha</li>
</ul>

<p>An Alpha level release, noted with <em>alpha</em> in the name, may be buggy and is disabled by default. Features could change or disappear at any time. Only use these features on a test cluster which is often rebuilt.</p>

<ul>
  <li>Beta</li>
</ul>

<p>The Beta level, found with <em>beta</em> in the name, has more well-tested code and is enabled by default. It also ensures that, as changes move forward, they will be tested for backwards compatibility between versions. It has not been adopted and tested enough to be called stable. You can expect some bugs and issues.</p>

<ul>
  <li>Stable</li>
</ul>

<p>Use of the <em>Stable</em> version, denoted by only an integer which may be preceded by the letter <em>v</em>, is for stable APIs.</p>


    <div class="tags">
        
    </div>


<div id="commento"></div>
<script src="https://cdn.commento.io/js/commento.js"></script>
<noscript>Please enable JavaScript to load the comments.</noscript>



</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2020 原生云技术. All rights reserved. <br />
 Site last generated: Jun 29, 2020 <br />
<p><img src="images/company_logo.png" alt="Company logo"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
